# Vulnerability Time-Decay Scoring Documentation

## Overview

The Vulnerability Time-Decay Scoring system implements the third pillar (30% weight) of the MCP Security Analysis System. It uses a sophisticated time-based penalty model where vulnerabilities accumulate additional deductions based on how long they remain unpatched, with severity-appropriate decay rates.

### Key Principles

1. **No Bonus for Perfection**: Unlike other pillars, there's no bonus for having zero vulnerabilities
2. **Time Sensitivity**: Older vulnerabilities are penalized more heavily
3. **Severity-Based Decay**: Critical vulnerabilities decay faster than low-severity ones
4. **KEV Priority**: Known Exploited Vulnerabilities receive double penalties
5. **Hard Caps**: Critical vulnerabilities over 30 days cap the score at 579 (Poor)

## Scoring Algorithm

### Base Deductions (Day 0)

| Severity | CVSS Range | Base Deduction | With KEV (2x) |
|----------|------------|----------------|---------------|
| **Critical** | 9.0-10.0 | -120 points | -240 points |
| **High** | 7.0-8.9 | -80 points | -160 points |
| **Medium** | 4.0-6.9 | -40 points | -80 points |
| **Low** | 0.1-3.9 | -15 points | -30 points |
| **Unknown** | No CVSS | -25 points | -50 points |

### Daily Decay Penalties

Additional penalties accumulate daily based on severity:

| Severity | Daily Decay Rate | Max Age Penalty (90 days) | Notes |
|----------|-----------------|---------------------------|-------|
| **Critical** | -2.0 points/day | -180 points | Aggressive decay encourages immediate patching |
| **High** | -1.0 points/day | -90 points | Steady decay for high-risk issues |
| **Medium** | -0.5 points/day | -45 points | Moderate decay allows planned remediation |
| **Low** | -0.1 points/day | -9 points | Minimal decay for low-risk issues |
| **Unknown** | -0.3 points/day | -27 points | Conservative penalty for unscored vulnerabilities |

### Special Rules

1. **Ancient Vulnerability Penalty**: Additional -50 points for vulnerabilities > 365 days old
2. **KEV Multiplier**: 2x base deduction for CISA Known Exploited Vulnerabilities
3. **Critical Age Cap**: Any critical vulnerability > 30 days caps score at 579
4. **No Zero-Vulnerability Bonus**: Perfect security doesn't earn extra points

## Score Calculation Example

### Scenario: Mixed Vulnerability Profile

Repository with 4 vulnerabilities:
1. **Critical (CVE-2024-001)**: CVSS 9.5, 45 days old, in KEV
2. **High (CVE-2024-002)**: CVSS 7.8, 120 days old
3. **Medium (CVE-2024-003)**: CVSS 5.3, 10 days old
4. **Low (CVE-2024-004)**: CVSS 2.1, 400 days old

### Calculation Steps

```python
Starting Score: 850

1. Critical (KEV, 45 days):
   Base: -120 × 2 (KEV) = -240
   Age: min(-90, 45 × -2.0) = -90
   Subtotal: -330

2. High (120 days):
   Base: -80
   Age: min(-90, 90 × -1.0) = -90 (capped at 90 days)
   Subtotal: -170

3. Medium (10 days):
   Base: -40
   Age: 10 × -0.5 = -5
   Subtotal: -45

4. Low (400 days):
   Base: -15
   Age: min(-9, 90 × -0.1) = -9
   Ancient penalty: -50
   Subtotal: -74

Total Deduction: -619
Raw Score: 850 - 619 = 231

After floor (300): 300
After critical>30 cap: 300 (already at minimum)

Final Score: 300 (Grade F)
```

## Age Buckets and Remediation Windows

### Vulnerability Age Classification

| Age Bucket | Days | Remediation Expectation | Industry Standard |
|------------|------|------------------------|-------------------|
| **Fresh** | 0-7 | Immediate response for critical | CISA: 15 days for critical |
| **Recent** | 8-30 | Active remediation | CISA: 30 days for high |
| **Aging** | 31-90 | Should be in patch cycle | FedRAMP: 30-90 days |
| **Old** | 91-180 | Overdue for remediation | PCI-DSS: 90 days max |
| **Stale** | 181-365 | Significant risk accumulation | Unacceptable delay |
| **Ancient** | 365+ | Severe negligence penalty | Critical failure |

## Remediation Priority Framework

### Priority Levels

1. **Priority 1 - Known Exploited (KEV)**
   - Action: Patch immediately
   - Urgency: CRITICAL
   - Target: 24-48 hours

2. **Priority 2 - Aged Critical**
   - Action: Emergency patching required
   - Urgency: HIGH
   - Target: 7 days

3. **Priority 3 - Exploitable**
   - Action: Expedited patching
   - Urgency: HIGH
   - Target: 14 days

4. **Priority 4 - Ancient Vulnerabilities**
   - Action: Include in next patch cycle
   - Urgency: MEDIUM
   - Target: 30 days

## Integration with System

### Pipeline Flow

```
Repository → SBOM Generator → SBOM File → OSV Scanner → Vulnerabilities → Time-Decay Scorer → FICO Score
```

### Component Interaction

```python
# Complete pipeline example
async def assess_vulnerability_risk(repo_path: str):
    # Step 1: Generate SBOM
    sbom_gen = SBOMGenerator(
        generator_type=GeneratorType.CDXGEN,
        include_dev_deps=False  # Exclude dev for security
    )
    sbom_result = await sbom_gen.generate_sbom(repo_path)

    # Step 2: Scan for vulnerabilities
    osv = OSVScanner(
        check_kev=True,
        min_cvss=0.0  # Include all severities
    )
    scan_result = await osv.scan_sbom(sbom_result.sbom_path)

    # Step 3: Apply time-decay scoring
    scorer = VulnerabilityTimeScorer()
    score = scorer.calculate_score(scan_result)

    return score
```

## Score Interpretation

### FICO Score Ranges

| Score Range | Grade | Risk Level | Interpretation |
|-------------|-------|------------|----------------|
| **800-850** | A | Excellent | Minimal vulnerabilities, well-maintained |
| **670-799** | B | Good | Some vulnerabilities, acceptable risk |
| **580-669** | C | Fair | Significant vulnerabilities, needs attention |
| **300-579** | F | Poor | Critical vulnerabilities or severe neglect |

### Key Indicators

- **Score < 580**: Immediate action required
- **KEV Count > 0**: Emergency patching needed
- **Mean Age > 90 days**: Process failure indicated
- **Critical Age > 30 days**: Caps score at 579

## Remediation Impact Calculator

### Projecting Score Improvements

```python
# Calculate impact of fixing specific vulnerabilities
current_score = 425
vulns_to_fix = [
    ("critical", 45),  # Fix 45-day-old critical
    ("high", 120)      # Fix 120-day-old high
]

# Calculate improvement
removed_deductions = 0
for severity, age in vulns_to_fix:
    base = BASE_DEDUCTIONS[severity]
    age_penalty = calculate_age_penalty(severity, age)
    removed_deductions += abs(base) + abs(age_penalty)

new_score = min(850, current_score + removed_deductions)
# Result: 425 + 500 = 850 (after fixing both)
```

## Best Practices

### 1. Continuous Monitoring
- Scan daily to track age progression
- Alert on new KEV additions
- Track mean vulnerability age trends

### 2. Remediation Strategy
```python
# Prioritize by impact
priorities = [
    vulns.filter(is_kev=True),           # First: KEV
    vulns.filter(severity="critical"),    # Second: Critical
    vulns.filter(age_days > 90),         # Third: Old
    vulns.filter(exploit_available=True)  # Fourth: Exploitable
]
```

### 3. Process Metrics
- **MTTR Target**: < 30 days for critical
- **KEV Response**: < 48 hours
- **Patch Coverage**: > 95% within SLA

### 4. Score Maintenance
- Keep score above 670 (B grade)
- Never let critical vulnerabilities age past 30 days
- Address KEV immediately upon detection

## Common Patterns and Anti-Patterns

### Good Patterns ✅
- Immediate KEV response
- Regular patch cycles
- Vulnerability age tracking
- Risk-based prioritization

### Anti-Patterns ❌
- Ignoring low-severity vulnerabilities (they accumulate)
- Delaying critical patches
- Not tracking vulnerability age
- Focusing only on count, not age

## Metrics and KPIs

### Key Metrics to Track

1. **Mean Time to Remediate (MTTR)**
   - Target: < 30 days overall
   - Critical: < 15 days
   - High: < 30 days

2. **Vulnerability Age Distribution**
   ```python
   age_distribution = {
       "0-7 days": 40%,     # Fresh vulnerabilities
       "8-30 days": 35%,    # Under active remediation
       "31-90 days": 20%,   # In patch queue
       "90+ days": 5%       # Should be minimal
   }
   ```

3. **KEV Response Time**
   - Detection to patch: < 48 hours
   - Success rate: > 95%

4. **Score Stability**
   - Maintain above 670
   - Avoid drops below 580

## Configuration Options

### VulnerabilityTimeScorer Parameters

```python
scorer = VulnerabilityTimeScorer(
    base_score=850,  # Starting FICO score
    min_score=300    # Floor score
)

# Customizable thresholds (if extended)
scorer.CRITICAL_AGE_CAP_DAYS = 30  # When to cap score
scorer.ANCIENT_VULNERABILITY_DAYS = 365  # Ancient threshold
scorer.KEV_MULTIPLIER = 2.0  # KEV penalty multiplier
```

### Tuning Recommendations

1. **For High-Security Environments**
   - Increase daily decay rates
   - Lower critical age cap (e.g., 14 days)
   - Higher KEV multiplier (e.g., 3x)

2. **For Development Environments**
   - Standard decay rates
   - Focus on critical/high only
   - Longer age allowances

3. **For Legacy Systems**
   - Adjusted baselines
   - Extended remediation windows
   - Compensating controls consideration

## Appendix: Decay Curves

### Visualization of Penalty Accumulation

```
Days    Critical   High      Medium    Low
0       -120       -80       -40       -15
7       -134       -87       -43.5     -15.7
14      -148       -94       -47       -16.4
30      -180       -110      -55       -18
60      -240       -140      -70       -21
90      -300       -170      -85       -24
180     -300       -170      -85       -24
365     -350       -220      -135      -74
```

Note: Includes base + age penalties. Ancient penalty (+50) applies after 365 days.

---

*This scoring model incentivizes rapid vulnerability remediation while reflecting real-world risk through time-based decay. The absence of bonuses for zero vulnerabilities ensures organizations focus on continuous improvement rather than achieving perfection.*